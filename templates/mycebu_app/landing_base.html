{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyCebu - Government Services</title>
    
    <link rel="stylesheet" href="{% static 'mycebu_app/css/globals.css' %}">
    <link rel="stylesheet" href="{% static 'mycebu_app/css/header.css' %}">
    
    {% if current_tab == "landing" %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/home.css' %}">
    {% elif current_tab == 'dashboard' %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/dashboard.css' %}">
    <script src="{% static 'mycebu_app/js/dashboard.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'mycebu_app/css/services.css' %}">
    {% elif current_tab == 'services' %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/services.css' %}">
    <script src="{% static 'mycebu_app/js/services.js' %}" defer></script>
    <script src="{% static 'mycebu_app/js/services-filter.js' %}" defer></script>
    {% elif current_tab == 'ordinances' %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/ordinances.css' %}">
    <script src="{% static 'mycebu_app/js/ordinances.js' %}" defer></script>
    {% elif current_tab == 'directory' %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/directory.css' %}">
    <script src="{% static 'mycebu_app/js/directory.js' %}" defer></script>
    <script src="{% static 'mycebu_app/js/directory-filter.js' %}" defer></script>
    <script src="{% static 'mycebu_app/js/directory-tab.js' %}" defer></script>
    {% elif current_tab == 'news' %}
    <link rel="stylesheet" href="{% static 'mycebu_app/css/news.css' %}">
    <script src="{% static 'mycebu_app/js/news.js' %}" defer></script>
    {% endif %}

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'mycebu_app/css/chatbot.css' %}">
    
</head>

<body>
    {% comment %} 
    Define the target URL once based on user role 
    {% endcomment %}
    {% if authed_user and authed_user.role == 'admin' %}
        {% url 'landing_tab' tab='admin_dashboard' as home_target_url %}
    {% elif authed_user %}
        {% url 'landing_tab' tab='dashboard' as home_target_url %}
    {% else %}
        {% url 'landing_tab' tab='landing' as home_target_url %}
    {% endif %}

    <nav class="topnav">
        <div class="nav-container">
            <div class="logo" style="display:flex;align-items:center;gap:10px;">
                <button class="hamburger" id="hamburger" aria-label="Open menu" aria-controls="mobile-drawer"
                    aria-expanded="false">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
                <img src="{% static 'mycebu_app/icons/mycebu-logo.png' %}" alt="Logo" style="width:40px;height:auto;">
                <div>
                    <h3>MyCebu</h3>
                    <span>Government Services</span>
                </div>
            </div>

            <div class="nav-links">
                <a class="{% if current_tab == 'landing' or current_tab == 'dashboard' or current_tab == 'admin_dashboard' %}active{% endif %}"
                    href="{{ home_target_url }}">
                    Home
                </a>
                <a class="{% if current_tab == 'services' %}active{% endif %}"
                    href="{% url 'landing_tab' tab='services' %}">Services</a>
                <a class="{% if current_tab == 'ordinances' %}active{% endif %}"
                    href="{% url 'landing_tab' tab='ordinances' %}">Ordinances</a>
                <a class="{% if current_tab == 'directory' %}active{% endif %}"
                    href="{% url 'landing_tab' tab='directory' %}">Directory</a>
                <a class="{% if current_tab == 'news' %}active{% endif %}" 
                    href="{% url 'landing_tab' tab='news' %}">News</a>
                <span class="highlight"></span>
            </div>

            <div class="account">
                {% if authed_user %}
                <div class="who">
                    <strong>{{ authed_user.display_name|default:authed_user.email }}</strong>
                    <span>{{ authed_user.email }}</span>
                </div>
                <a href="{% url 'landing_tab' tab='profile' %}" class="avatar-link" aria-label="Profile">
                    <img class="avatar"
                        src="{% if authed_user and authed_user.avatar_url %}{{ authed_user.avatar_url }}{% else %}{% static 'mycebu_app/icons/blank.png' %}{% endif %}"
                        alt="Profile">
                </a>
                {% else %}
                <a href="{% url 'login' %}" class="sign-in">Sign in</a>
                <a href="{% url 'register' %}" class="dashboard">Sign Up</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="mobile-overlay" id="mobile-overlay"></div>

    <aside class="mobile-drawer" id="mobile-drawer" aria-hidden="true">
        <div class="drawer-header">
            <img class="avatar"
                src="{% if authed_user and authed_user.avatar_url %}{{ authed_user.avatar_url }}{% else %}{% static 'mycebu_app/icons/blank.png' %}{% endif %}"
                alt="Profile">
            <div class="who">
                {% if authed_user %}
                <strong>{{ authed_user.display_name|default:authed_user.email }}</strong>
                <span>{{ authed_user.email }}</span>
                {% else %}
                <strong>Guest</strong>
                <span>Not signed in</span>
                {% endif %}
            </div>
            <button class="drawer-close" id="drawer-close" aria-label="Close menu">Ã—</button>
        </div>

        <nav class="drawer-nav">
            <a class="item {% if current_tab == 'landing' or current_tab == 'dashboard' or current_tab == 'admin_dashboard' %}active{% endif %}"
                href="{{ home_target_url }}">
                <span class="material-icons">home</span>
                <span>Home</span>
            </a>
            <a class="item {% if current_tab == 'services' %}active{% endif %}" href="{% url 'landing_tab' tab='services' %}">
                <span class="material-icons">description</span>
                <span>Services</span>
            </a>
            <a class="item {% if current_tab == 'ordinances' %}active{% endif %}"
                href="{% url 'landing_tab' tab='ordinances' %}">
                <span class="material-icons">gavel</span>
                <span>Ordinances</span>
            </a>
            <a class="item {% if current_tab == 'directory' %}active{% endif %}"
                href="{% url 'landing_tab' tab='directory' %}">
                <span class="material-icons">contact_phone</span>
                <span>Directory</span>
            </a>
            <a class="item {% if current_tab == 'news' %}active{% endif %}" href="{% url 'landing_tab' tab='news' %}">
                <span class="material-icons">newspaper</span>
                <span>News</span>
            </a>
        </nav>

        <div class="drawer-footer">
            {% if authed_user %}
            <a class="item" href="#">
                <span class="material-icons">settings</span>
                <span>Settings</span>
            </a>
            <a class="item" href="{% url 'logout' %}">
                <span class="material-icons">logout</span>
                <span>Logout</span>
            </a>
            {% else %}
            <a class="item" href="{% url 'login' %}">
                <span class="material-icons">login</span>
                <span>Sign in</span>
            </a>
            {% endif %}
        </div>
    </aside>

    <main>
        {% block content %}{% endblock content %}
    </main>

    <footer>
        <p>Â© 2025 MyCebu Government Services. All rights reserved.</p>
    </footer>

    <div class="chatbot-root" id="chatbot-root">
        <button class="chatbot-toggle" id="chatbot-toggle" aria-expanded="false" aria-controls="chatbot-panel">
            <span class="material-icons chatbot-toggle-icon">support_agent</span>
            <span class="chatbot-toggle-label">Get Help</span>
        </button>

        <section class="chatbot-panel" id="chatbot-panel" aria-hidden="true">
            <header class="chatbot-header">
                <div class="chatbot-header-main">
                    <div class="chatbot-logo">
                        <span class="material-icons">support_agent</span>
                    </div>
                    <div class="chatbot-header-text">
                        <h2>Hello{% if authed_user %} {{ authed_user.first_name|default:authed_user.display_name }}{% endif %} ðŸ‘‹</h2>
                        <p>How can we help you today?</p>
                    </div>
                </div>
                <div class="chatbot-header-actions">
                    <button class="chatbot-new-chat" id="chatbot-new-chat" title="New Chat">
                        <span class="material-icons" style="font-size:18px;">add</span>
                    </button>
                    <button class="chatbot-close" id="chatbot-close" aria-label="Close help panel">
                        <span class="material-icons">close</span>
                    </button>
                </div>
            </header>

            <div class="chatbot-tabs">
                <button class="chatbot-tab is-active" data-tab="chat">Chat</button>
                <button class="chatbot-tab" data-tab="history">History</button>
            </div>

            <div class="chatbot-body" data-view="chat">
                <div class="chatbot-message-placeholder">
                    <p>This is a preview of the MyCebu assistant. Type a question below to start a conversation.</p>
                </div>
            </div>

            <div class="chatbot-body chatbot-body--hidden" data-view="history">
                <div class="chatbot-history-empty chatbot-message-placeholder" data-history-empty>
                    <p>Your recent conversations will appear here.</p>
                </div>
                <div class="chatbot-history-list" data-history-list></div>
            </div>

            <form class="chatbot-input-bar" id="chatbot-form">
                <div id="chatbot-input" class="chatbot-input" contenteditable="true"></div>
                <button type="submit" class="chatbot-send" aria-label="Send">
                    <span class="material-icons">send</span>
                </button>
            </form>
        </section>
    </div>

    <script src="{% static 'mycebu_app/js/chatbot.js' %}" defer></script>
    <script src="{% static 'mycebu_app/js/header.js' %}" defer></script>
    <script src="{% static 'mycebu_app/js/section-skeleton.js' %}" defer></script>

    
</body>
</html>