{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyCebu - User Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'mycebu_app/css/ordinances.css' %}">
    <link rel="stylesheet" href="{% static 'mycebu_app/css/profile.css' %}?v=1.5">
    <script defer src="{% static 'mycebu_app/js/profile.js' %}"></script>
</head>

<body class="bg-gradient-to-r from-blue-100 to-white min-h-screen p-4 sm:p-6 md:p-8">
    {% if messages %}
    {% for message in messages %}
    <div class="fixed top-5 right-5 z-50 bg-gray-900 text-white py-2 px-5 rounded-lg shadow-lg opacity-100 transform translate-y-0 transition-all duration-300">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

    <section class="tab-content-section" data-loading="false" data-skel="profile">

        <div class="container">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">

                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="header-top">
                        <a href="#" id="back-button">
                            <span class="material-icons" style="font-size: 20px;">arrow_back</span>
                            Back to Home
                        </a>
                    </div>
                    <div class="avatar-section">
                        <div class="main-avatar-container">
                            <img id="main-avatar" src="{{ user.avatar_url|default:'https://placehold.co/120x120/E2E8F0/4A5568?text=US' }}?v={% now 'U' %}" alt="User Avatar">
                            <label for="avatar-upload" class="avatar-edit-label">
                                <span class="material-icons" style="font-size: 20px;">edit</span>
                                <input type="file" id="avatar-upload" name="avatar" class="hidden" accept="image/*" form="profile-form">
                            </label>
                        </div>
                        <div>
                            <h1 class="profile-title">My Profile</h1>
                            <p class="profile-subtitle">Manage your personal information and preferences</p>
                        </div>
                    </div>
                </div>

                <div id="profile" class="tab-content active">

                    <form id="profile-form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        {% if errors %}
                        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                            <h3 class="font-medium text-red-800 mb-2">Please correct the following errors:</h3>
                            <ul class="text-red-700 space-y-1">
                                {% for key, value in errors.items %}
                                <li>â€¢ {{ value }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h2 class="section-title">
                            <span class="material-icons">person</span>
                            Personal Information
                        </h2>
                        <div class="form-grid">
                            <div class="form-field">
                                <label for="first_name" class="field-label">
                                    <span class="material-icons">person</span>
                                    First Name
                                </label>
                                <span data-value="{{ user.first_name|default:'' }}" class="profile-view-field">{{ user.first_name|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name|default:'' }}" required>
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="last_name" class="field-label">
                                    <span class="material-icons">person</span>
                                    Last Name
                                </label>
                                <span data-value="{{ user.last_name|default:'' }}" class="profile-view-field">{{ user.last_name|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name|default:'' }}" required>
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="email" class="field-label">
                                    <span class="material-icons">email</span>
                                    Email Address
                                </label>
                                <span data-value="{{ user.email }}" class="profile-view-field">{{ user.email }}</span>
                                <div class="profile-edit-field">
                                    <input type="email" id="email" name="email" value="{{ user.email }}">
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="contact_number" class="field-label">
                                    <span class="material-icons">phone</span>
                                    Contact Number
                                </label>
                                <span data-value="{{ user.contact_number|default:'' }}" class="profile-view-field">{{ user.contact_number|default:'Not set' }}</span>
                                <div class="profile-edit-field contact-input-container">
                                    <span class="contact-prefix">+63</span>
                                    <input type="tel" id="contact_number" name="contact_number" value="{{ user.contact_number|default:'' }}" maxlength="10" pattern="[0-9]{10}">
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="birthdate" class="field-label">
                                    <span class="material-icons">cake</span>
                                    Birthday
                                </label>
                                <span data-value="{{ user.birthdate|default:'' }}" class="profile-view-field">{{ user.birthdate|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <input type="date" id="birthdate" name="birthdate" value="{{ user.birthdate|default:'' }}">
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="age" class="field-label">
                                    <span class="material-icons">schedule</span>
                                    Age
                                </label>
                                <span data-value="{{ user.age|default:'' }}" class="profile-view-field">{{ user.age|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <input type="number" id="age" name="age" value="{{ user.age|default:'' }}" min="0" max="120">
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="gender" class="field-label">
                                    <span class="material-icons">wc</span>
                                    Gender
                                </label>
                                <span data-value="{{ user.gender|default:'' }}" class="profile-view-field">{{ user.gender|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <select id="gender" name="gender">
                                        <option value="" {% if not user.gender %}selected{% endif %}>Select Gender</option>
                                        <option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>Female</option>
                                        <option value="Prefer not to say" {% if user.gender == 'Prefer not to say' %}selected{% endif %}>Prefer not to say</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="marital_status" class="field-label">
                                    <span class="material-icons">favorite</span>
                                    Marital Status
                                </label>
                                <span data-value="{{ user.marital_status|default:'' }}" class="profile-view-field">{{ user.marital_status|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <select id="marital_status" name="marital_status">
                                        <option value="" {% if not user.marital_status %}selected{% endif %}>Select Status</option>
                                        <option value="Single" {% if user.marital_status == 'Single' %}selected{% endif %}>Single</option>
                                        <option value="Married" {% if user.marital_status == 'Married' %}selected{% endif %}>Married</option>
                                        <option value="Widowed" {% if user.marital_status == 'Widowed' %}selected{% endif %}>Widowed</option>
                                        <option value="Separated" {% if user.marital_status == 'Separated' %}selected{% endif %}>Separated</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="religion" class="field-label">
                                    <span class="material-icons">church</span>
                                    Religion
                                </label>
                                <span data-value="{{ user.religion|default:'' }}" class="profile-view-field">{{ user.religion|default:'Not set' }}</span>
                                <div class="profile-edit-field">
                                    <input type="text" id="religion" name="religion" value="{{ user.religion|default:'' }}" list="religion-list">
                                    <datalist id="religion-list">
                                        <option value="Roman Catholic">
                                        <option value="Islam">
                                        <option value="Iglesia ni Cristo">
                                        <option value="Philippine Independent Church">
                                        <option value="Seventh-day Adventist">
                                        <option value="Jehovah's Witnesses">
                                        <option value="Born Again Christian">
                                        <option value="Protestant">
                                        <option value="Buddhist">
                                        <option value="Hindu">
                                        <option value="Atheist">
                                        <option value="Agnostic">
                                        <option value="Other">
                                    </datalist>
                                </div>
                            </div>
                        </div>
                    </div>

                   <!-- Address Information Section -->
                   <div class="form-section">
                       <h2 class="section-title">
                           <span class="material-icons">location_on</span>
                           Address Information
                       </h2>
                       <div class="form-grid">
                           <div class="form-field">
                               <label for="birthplace" class="field-label">
                                   <span class="material-icons">location_on</span>
                                   Birthplace
                               </label>
                               <span data-value="{{ user.birthplace|default:'' }}" class="profile-view-field">{{ user.birthplace|default:'Not set' }}</span>
                               <div class="profile-edit-field">
                                   <input type="text" id="birthplace" name="birthplace" value="{{ user.birthplace|default:'' }}">
                               </div>
                           </div>
                           <div class="form-field">
                               <label for="city" class="field-label">
                                   <span class="material-icons">location_city</span>
                                   City
                               </label>
                               <span data-value="{{ user.city|default:'' }}" class="profile-view-field">{{ user.city|default:'Not set' }}</span>
                               <div class="profile-edit-field">
                                   <select id="city" name="city">
                                       <option value="">Select City</option>
                                       <option value="Cebu City" {% if user.city == 'Cebu City' %}selected{% endif %}>Cebu City</option>
                                       <option value="Mandaue City" {% if user.city == 'Mandaue City' %}selected{% endif %}>Mandaue City</option>
                                       <option value="Lapu-Lapu City" {% if user.city == 'Lapu-Lapu City' %}selected{% endif %}>Lapu-Lapu City</option>
                                       <option value="Talisay City" {% if user.city == 'Talisay City' %}selected{% endif %}>Talisay City</option>
                                       <option value="Consolacion" {% if user.city == 'Consolacion' %}selected{% endif %}>Consolacion</option>
                                       <option value="Cordova" {% if user.city == 'Cordova' %}selected{% endif %}>Cordova</option>
                                       <option value="Compostela" {% if user.city == 'Compostela' %}selected{% endif %}>Compostela</option>
                                       <option value="Daanbantayan" {% if user.city == 'Daanbantayan' %}selected{% endif %}>Daanbantayan</option>
                                       <option value="Other">Other</option>
                                   </select>
                               </div>
                           </div>
                           <div class="form-field">
                               <label for="purok" class="field-label">
                                   <span class="material-icons">home</span>
                                   Barangay
                               </label>
                               <span data-value="{{ user.purok|default:'' }}" class="profile-view-field">{{ user.purok|default:'Not set' }}</span>
                               <div class="profile-edit-field">
                                   <select id="purok" name="purok" disabled>
                                       <option value="">Select Barangay (Choose city first)</option>
                                   </select>
                               </div>
                           </div>
                       </div>
                   </div>

                   <!-- Form Actions -->
                   <div class="form-actions">
                       <button type="button" id="edit-button" class="btn btn-primary">
                           <span class="material-icons" style="font-size: 18px;">edit</span>
                           Edit Profile
                       </button>
                       <button type="button" id="cancel-button" class="btn btn-secondary">
                           <span class="material-icons" style="font-size: 18px;">close</span>
                           Cancel
                       </button>
                       <button type="submit" id="save-button" class="btn btn-primary">
                           <span class="material-icons" style="font-size: 18px;">save</span>
                           Save Changes
                       </button>
                   </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div id="toast" class="toast" style="display: none;">
        <span class="material-icons" style="font-size: 20px; margin-right: 8px;">check_circle</span>
        Profile saved successfully!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const messageElements = document.querySelectorAll('.fixed.top-5.right-5');
            messageElements.forEach(msg => {
                setTimeout(() => {
                    msg.classList.remove('opacity-100', 'translate-y-0');
                    msg.classList.add('opacity-0', 'translate-y-10');
                }, 3000);
            });

            const avatar = document.querySelector('#sidebar-avatar, #main-avatar');
            const displayName = "{{ user.display_name }}";
            if (displayName && avatar && !avatar.src.includes('placehold.co') && !avatar.src.includes('cloudinary')) {
                const initials = displayName.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
                if (!avatar.src || avatar.src.includes('US')) {
                    avatar.src = `https://placehold.co/100x100/E2E8F0/4A5568?text=${initials}`;
                }
            }
        });
    </script>
</body>
</html>
