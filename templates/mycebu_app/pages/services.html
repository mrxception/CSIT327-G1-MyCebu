{% extends 'mycebu_app/landing_base.html' %}
{% load static %}

{% block content %}
<section class="tab-content-section" data-loading="false" data-skel="services-all">
  <header class="svc-hero">
    <div class="container">
      <div class="svc-hero__badge">
        <svg class="i i--badge" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" fill="none" stroke="currentColor"
            stroke-width="2" />
          <path d="M14 2v6h6" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
        Government Services Portal
      </div>
      <h1 class="svc-hero__title">Cebu City Services</h1>
      <p class="svc-hero__desc">Access comprehensive guides for permits, clearances, and government services.</p>
    </div>
  </header>

  {% if service_selected %}
  <section class="svc-detail">
    <a class="btn btn--ghost mb-24" href="{% url 'landing_tab' 'services' %}">‚Üê Back to Services</a>
    <div class="detail-card">
      <div class="svc-detail__head">
        <div class="svc-icon svc-icon--{{ service_selected.color|default:'primary' }}">
          {% if service_selected.icon == "building" %}
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
            fill="var(--secondary-600)">
            <path stroke="currentColor"
              d="M200-280v-280h80v280h-80Zm240 0v-280h80v280h-80ZM80-640v-80l400-200 400 200v80H80Zm179-80h442L480-830 259-720ZM80-120v-80h482q2 21 5 40.5t9 39.5H80Zm600-310v-130h80v90l-80 40ZM800 0q-69-17-114.5-79.5T640-218v-102l160-80 160 80v102q0 76-45.5 138.5T800 0Zm-29-120 139-138-42-42-97 95-39-39-42 43 81 81ZM259-720h442-442Z" />
          </svg>
          {% elif service_selected.icon == "file" %}
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
            fill="var(--primary)">
            <path stroke="currentColor"
              d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520v-200H240v640h480v-440H520ZM240-800v200-200 640-640Z" />
          </svg>
          {% elif service_selected.icon == "shield" %}
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" fill="none" stroke="currentColor" stroke-width="2" />
          </svg>
          {% elif service_selected.icon == "receipt" %}
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 2v20l-3-2-3 2-3-2-3 2-3-2-3 2V2h18Zm-12 6h6m-6 4h6" fill="none" stroke="currentColor"
              stroke-width="2" />
          </svg>
          {% else %}
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" />
          </svg>
          {% endif %}
        </div>
        <div class="svc-titlewrap">
          <h1 class="svc-detail__title">{{ service_selected.title }}</h1>
          <p class="muted svc-detail__subtitle">{{ service_selected.description }}</p>
        </div>
      </div>

      <div class="svc-block">
        <h2 class="svc-block__title">
          <svg class="title-icon" viewBox="0 0 48 48" aria-hidden="true">
            <circle cx="24" cy="24" r="20" fill="currentColor" opacity=".12" />
            <path d="M16 24l6 6 12-12" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          Requirements
        </h2>
        <div class="det-card p-16">
          <ul class="bullet-list">
            {% for req in service_selected.requirements %}
            <li>{{ req }}</li>
            {% empty %}
            <li>No listed requirements.</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div class="svc-block">
        <h2 class="svc-block__title">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
            fill="var(--secondary-600)">
            <path
              d="M120-80v-60h100v-30h-60v-60h60v-30H120v-60h120q17 0 28.5 11.5T280-280v40q0 17-11.5 28.5T240-200q17 0 28.5 11.5T280-160v40q0 17-11.5 28.5T240-80H120Zm0-280v-110q0-17 11.5-28.5T160-510h60v-30H120v-60h120q17 0 28.5 11.5T280-560v70q0 17-11.5 28.5T240-450h-60v30h100v60H120Zm60-280v-180h-60v-60h120v240h-60Zm180 440v-80h480v80H360Zm0-240v-80h480v80H360Zm0-240v-80h480v80H360Z" />
          </svg>
          Steps to Get the {{ service_selected.title }}
        </h2>
        <div class="det-card p-16">
          <ol class="steps">
            {% for step in service_selected.combined_steps %}
            <li class="step-item" data-step="{{ forloop.counter }}">
              <div class="step-num">{{ forloop.counter }}</div>
              <div class="step-text">
                {{ step.step }}
                <span class="step-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"
                    stroke-linecap="round" stroke-linejoin="round" style="width:24px;height:24px">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg></span>
              </div>
              <div class="step-extra">
                <p>{{ step.detail|safe }}</p>
              </div>
            </li>
            {% endfor %}
          </ol>
        </div>
      </div>

      {% if service_selected.additionalInfo %}
      <div class="svc-block">
        <h2 class="svc-block__title">
          <svg class="title-icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="10" fill="currentColor" opacity=".15" />
            <path d="M12 7v6m0 4h.01" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
          {{ service_selected.additionalInfo.title }}
        </h2>
        <div class="det-card p-16 warn">
          <p class="muted" style="margin-top:-15px;padding-top:0;">{{ service_selected.additionalInfo.subtitle|safe }}
          </p>
          <ul class="bullet-list">
            {% for line in service_selected.additionalInfo.content %}
            <li>{{ line }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endif %}

      {% if service_selected.forms and service_selected.forms|length > 0 %}
      <div class="svc-block">
        <h2 class="svc-block__title">
          <svg class="title-icon" viewBox="0 0 48 48" aria-hidden="true">
            <path d="M24 10v18m0 0 7-7m-7 7-7-7M12 38h24" fill="none" stroke="currentColor" stroke-width="3"
              stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Downloadable Forms
        </h2>
        <div class="det-card p-0">
          <div class="form-row">
            {% for item in service_selected.forms_with_links %}
            <div class="form-item">
              <div class="form-item__name">
                <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M14 2v6h6M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" fill="none"
                    stroke="currentColor" stroke-width="2" />
                </svg>
                {{ item.name }}
              </div>
              {% if item.link %}
              <a class="btn btn--outline" href="{{ item.link }}" target="_blank" rel="noopener" download>
                <svg class="i" style="width:16px;height:16px" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 3v12m0 0 4-4m-4 4-4-4M5 21h14" fill="none" stroke="currentColor" stroke-width="2" />
                </svg>
                Download
              </a>
              {% else %}
              <button class="btn btn--outline" disabled>Not available</button>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </section>
  {% else %}
  <section class="services-section">
    <div class="filter-bar">
      <form class="container" id="form-services" onsubmit="return false;">
        <div class="grid">
          <div class="input-wrap">
            <svg class="input-icon" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2" />
              <path d="M20 20L16.65 16.65" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            <input class="input input--search" id="q-services" type="text"
              placeholder="Search by service name or description">
          </div>
        </div>
      </form>
    </div>

    <div class="services-container">
      <h2 class="h2">Available Services</h2>
      <div class="svc-grid" id="grid-services">
        {% for s in services_data %}
        <a class="svc-card" href="{% url 'landing_tab' 'services' %}?id={{ s.service_id }}" data-title="{{ s.title|lower }}"
          data-desc="{{ s.description|lower }}">
          <div class="svc-card__icon svc-icon svc-icon--{{ s.color|default:'primary' }}">
            {% if s.icon == "building" %}
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
              fill="var(--secondary-600)">
              <path
                d="M200-280v-280h80v280h-80Zm240 0v-280h80v280h-80ZM80-640v-80l400-200 400 200v80H80Zm179-80h442L480-830 259-720ZM80-120v-80h482q2 21 5 40.5t9 39.5H80Zm600-310v-130h80v90l-80 40ZM800 0q-69-17-114.5-79.5T640-218v-102l160-80 160 80v102q0 76-45.5 138.5T800 0Zm-29-120 139-138-42-42-97 95-39-39-42 43 81 81ZM259-720h442-442Z"
                stroke-width="2" stroke="currentColor" />
            </svg>
            {% elif s.icon == "file" %}
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
              fill="var(--primary)">
              <path stroke="currentColor"
                d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520v-200H240v640h480v-440H520ZM240-800v200-200 640-640Z" />
            </svg>
            {% elif s.icon == "shield" %}
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" fill="none" stroke="currentColor"
                stroke-width="2" />
            </svg>
            {% elif s.icon == "receipt" %}
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M21 2v20l-3-2-3 2-3-2-3 2-3-2-3 2V2h18Zm-12 6h6m-6 4h6" fill="none" stroke="currentColor"
                stroke-width="2" />
            </svg>
            {% else %}
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" />
            </svg>
            {% endif %}
          </div>
          <h3 class="svc-card__title">{{ s.title }}</h3>
          <p class="svc-card__desc">{{ s.description }}</p>
          <div class="svc-card__cta">Access Guide</div>
        </a>
        {% empty %}
        <p class="muted">No services available.</p>
        {% endfor %}
      </div>
      <div class="empty-msg" id="empty-services" style="display:none;">No Services Found</div>
    </div>
  </section>
  {% endif %}
</section>

<script src="{% static 'mycebu_app/js/services.js' %}" defer></script>
{% endblock content %}